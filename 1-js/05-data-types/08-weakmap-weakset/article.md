# WeakMap —Ç–∞ WeakSet

–Ø–∫ –º–∏ –∑–Ω–∞—î–º–æ –∑ —Ä–æ–∑–¥—ñ–ª—É <info:garbage-collection>, —Ä—É—à—ñ–π JavaScript –∑–±–µ—Ä—ñ–≥–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –ø–∞–º‚Äô—è—Ç—ñ, –ø–æ–∫–∏ –≤–æ–Ω–æ —î "–¥–æ—Å—Ç—É–ø–Ω–∏–º" —ñ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–º.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```js
let john = { name: "–Ü–≤–∞–Ω" };

// –û–±‚Äô—î–∫—Ç –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏, john -- —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –Ω—å–æ–≥–æ

// –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
john = null;

*!*
// –æ–±‚Äô—î–∫—Ç –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –ø–∞–º‚Äô—è—Ç—ñ
*/!*
```

–ó–∞–∑–≤–∏—á–∞–π –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –æ–±‚Äô—î–∫—Ç–∞ –∞–±–æ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –º–∞—Å–∏–≤—É –∞–±–æ —ñ–Ω—à–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –≤–≤–∞–∂–∞—é—Ç—å—Å—è –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ø–∞–º‚Äô—è—Ç—ñ, –ø–æ–∫–∏ —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö —î –≤ –ø–∞–º‚Äô—è—Ç—ñ.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –º–∏ –ø–æ–∫–ª–∞–¥–µ–º–æ –æ–±‚Äô—î–∫—Ç –≤ –º–∞—Å–∏–≤, —Ç–æ, –ø–æ–∫–∏ –º–∞—Å–∏–≤ –∂–∏–≤–∏–π, –æ–±‚Äô—î–∫—Ç –±—É–¥–µ –∂–∏–≤–∏–º, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –Ω–µ–º–∞—î —ñ–Ω—à–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ —Ü–µ–π –æ–±‚Äô—î–∫—Ç.

–û—Å—å —Ç–∞–∫:

```js
let john = { name: "–Ü–≤–∞–Ω" };

let array = [ john ];

john = null; // –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

*!*
// –æ–±‚Äô—î–∫—Ç, –Ω–∞ —è–∫–∏–π —Ä–∞–Ω—ñ—à–µ –ø–æ—Å–∏–ª–∞–ª–∞—Å—è –∑–º—ñ–Ω–Ω–∞ john, –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–∞—Å–∏–≤—É
// —Ç–æ–º—É –≤—ñ–Ω –Ω–µ –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è
// –º–∏ –º–æ–∂–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ —è–∫ array[0]
*/!*
```

–ü–æ–¥—ñ–±–Ω–æ –¥–æ —Ü—å–æ–≥–æ, —è–∫—â–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –æ–±‚Äô—î–∫—Ç —è–∫ –∫–ª—é—á —É –∑–≤–∏—á–∞–π–Ω–æ–º—É `Map`, —Ç–æ –≤ —Ç–æ–π —á–∞—Å, –∫–æ–ª–∏ `Map` —ñ—Å–Ω—É—î, —Ü–µ–π –æ–±‚Äô—î–∫—Ç —Ç–∞–∫–æ–∂ —ñ—Å–Ω—É—î. –í—ñ–Ω –∑–∞–π–º–∞—î –ø–∞–º‚Äô—è—Ç—å —ñ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:

```js
let john = { name: "–Ü–≤–∞–Ω" };

let map = new Map();
map.set(john, "...");

john = null; // –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

*!*
// john –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ map,
// –º–∏ –º–æ–∂–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ map.keys()
*/!*
```

`WeakMap` -- –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤ —Ü—å–æ–º—É –∞—Å–ø–µ–∫—Ç—ñ. –í—ñ–Ω –Ω–µ –ø–µ—Ä–µ—à–∫–æ–¥–∂–∞—î –∑–±–∏—Ä–∞–Ω–Ω—é —Å–º—ñ—Ç—Ç—è —Å–µ—Ä–µ–¥ –æ–±‚Äô—î–∫—Ç—ñ–≤, —â–æ —î –∫–ª—é—á–∞–º–∏.

–ü–æ–¥–∏–≤–∏–º–æ—Å—è, —â–æ —Ü–µ –æ–∑–Ω–∞—á–∞—î –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥–∞—Ö.

## WeakMap

–ü–µ—Ä—à–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –º—ñ–∂ `Map` —Ç–∞ `WeakMap` -- —Ü–µ —Ç–µ, —â–æ –∫–ª—é—á—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ–±‚Äô—î–∫—Ç–∞–º–∏, –∞ –Ω–µ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏:

```js run
let weakMap = new WeakMap();

let obj = {};

weakMap.set(obj, "–æ–∫"); // –ø—Ä–∞—Ü—é—î (–æ–±‚Äô—î–∫—Ç —î –∫–ª—é—á–µ–º)

*!*
// –Ω–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä—è–¥–æ–∫ —è–∫ –∫–ª—é—á
weakMap.set("—Ç–µ—Å—Ç", "–û–π!"); // –ü–æ–º–∏–ª–∫–∞, —Ç–æ–º—É —â–æ "—Ç–µ—Å—Ç" –Ω–µ —î –æ–±‚Äô—î–∫—Ç–æ–º
*/!*
```

–¢–µ–ø–µ—Ä, —è–∫—â–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –æ–±‚Äô—î–∫—Ç —è–∫ –∫–ª—é—á, —ñ –Ω–µ–º–∞—î —ñ–Ω—à–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ —Ü–µ–π –æ–±‚Äô—î–∫—Ç -- –π–æ–≥–æ –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –ø–∞–º‚Äô—è—Ç—ñ (—ñ –∑ –º–∞–ø–∏) –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

```js
let john = { name: "–Ü–≤–∞–Ω" };

let weakMap = new WeakMap();
weakMap.set(john, "...");

john = null; // –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

// john –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –ø–∞–º‚Äô—è—Ç—ñ!
```

–ü–æ—Ä—ñ–≤–Ω—è–π—Ç–µ –π–æ–≥–æ –∑—ñ –∑–≤–∏—á–∞–π–Ω–∏–º `Map`, —â–æ –Ω–∞–≤–µ–¥–µ–Ω–∏–π –≤–∏—â–µ. –¢–µ–ø–µ—Ä, —è–∫—â–æ `john` —ñ—Å–Ω—É—î –ª–∏—à–µ —è–∫ –∫–ª—é—á `WeakMap` -- –≤—ñ–Ω –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑ –º–∞–ø–∏ (—ñ –∑ –ø–∞–º‚Äô—è—Ç—ñ).

`WeakMap` –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —ñ—Ç–µ—Ä–∞—Ü—ñ—é —Ç–∞ –º–µ—Ç–æ–¥–∏ `keys()`, `values()`, `entries()`, —Ç–æ–º—É –Ω–µ–º–∞—î —Å–ø–æ—Å–æ–±—É –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –∫–ª—é—á—ñ –∞–±–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤—ñ–¥ –Ω—å–æ–≥–æ.

`WeakMap` –º–∞—î –ª–∏—à–µ —Ç–∞–∫—ñ –º–µ—Ç–æ–¥–∏:

- `weakMap.get(key)`
- `weakMap.set(key, value)`
- `weakMap.delete(key)`
- `weakMap.has(key)`

–ß–æ–º—É —î —Ç–∞–∫–µ –æ–±–º–µ–∂–µ–Ω–Ω—è? –¶–µ –∑ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –ø—Ä–∏—á–∏–Ω. –Ø–∫—â–æ –æ–±‚Äô—î–∫—Ç –≤—Ç—Ä–∞—Ç–∏–≤ –≤—Å—ñ —ñ–Ω—à—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `john` —É –∫–æ–¥—ñ –≤–∏—â–µ), —Ç–æ –≤—ñ–Ω –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è. –ê–ª–µ —Ç–µ—Ö–Ω—ñ—á–Ω–æ –Ω–µ–º–∞—î —Ç–æ—á–Ω–∏—Ö –≤–∫–∞–∑—ñ–≤–æ–∫ *–∫–æ–ª–∏ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è*.

–†—É—à—ñ–π JavaScript –≤–∏—Ä—ñ—à—É—î —Ü–µ. –í—ñ–Ω –º–æ–∂–µ –≤–∏–±—Ä–∞—Ç–∏ –æ—á–∏—â–µ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ –Ω–µ–≥–∞–π–Ω–æ –∞–±–æ –ø–æ—á–µ–∫–∞—Ç–∏, —ñ –∑—Ä–æ–±–∏—Ç–∏ –æ—á–∏—â–µ–Ω–Ω—è –ø—ñ–∑–Ω—ñ—à–µ, –∫–æ–ª–∏ —Ç—Ä–∞–ø–∏—Ç—å—Å—è –±—ñ–ª—å—à–µ –≤–∏–¥–∞–ª–µ–Ω—å. –û—Ç–∂–µ, —Ç–µ—Ö–Ω—ñ—á–Ω–æ, –ø–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ `WeakMap` –Ω–µ–≤—ñ–¥–æ–º–∞. –†—É—à—ñ–π, –º–æ–∂–ª–∏–≤–æ, –æ—á–∏—Å—Ç–∏–≤ –π–æ–≥–æ —á–∏ –Ω—ñ, –∞–±–æ –∑—Ä–æ–±–∏–≤ —Ü–µ —á–∞—Å—Ç–∫–æ–≤–æ. –ó —Ü—ñ—î—ó –ø—Ä–∏—á–∏–Ω–∏ –º–µ—Ç–æ–¥–∏, —è–∫—ñ –¥–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö –∫–ª—é—á—ñ–≤/–∑–Ω–∞—á–µ–Ω—å –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è.

–û—Ç–∂–µ, –¥–µ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ç–∞–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö?

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ

–û—Å–Ω–æ–≤–Ω–∞ –æ–±–ª–∞—Å—Ç—å –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –¥–ª—è `WeakMap` -- —Ü–µ *–∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö*.

–Ø–∫—â–æ –º–∏ –ø—Ä–∞—Ü—é—î–º–æ –∑ –æ–±‚Äô—î–∫—Ç–æ–º, —â–æ "–Ω–∞–ª–µ–∂–∏—Ç—å" –¥–æ —ñ–Ω—à–æ–≥–æ –∫–æ–¥—É, –º–æ–∂–ª–∏–≤–æ –Ω–∞–≤—ñ—Ç—å —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, —ñ —Ö–æ—Ç—ñ–ª–∏ –± –∑–±–µ—Ä–µ–≥—Ç–∏ –¥–µ—è–∫—ñ –¥–∞–Ω—ñ, –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ –∑ –Ω–∏–º, —â–æ –ø–æ–≤–∏–Ω–Ω—ñ —ñ—Å–Ω—É–≤–∞—Ç–∏ –ª–∏—à–µ –ø–æ–∫–∏ –æ–±‚Äô—î–∫—Ç –∂–∏–≤–∏–π -- —Ç–æ–¥—ñ `WeakMap` —Ü—î —Å–∞–º–µ —Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

–ú–∏ –ø–æ–∫–ª–∞–¥–µ–º–æ –¥–∞–Ω—ñ –≤ `WeakMap`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–±‚Äô—î–∫—Ç —è–∫ –∫–ª—é—á, —ñ –∫–æ–ª–∏ –æ–±‚Äô—î–∫—Ç –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–æ –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è, —Ç–æ —Ü—ñ –¥–∞–Ω—ñ —Ç–∞–∫–æ–∂ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∏–∫–Ω—É—Ç—å.

```js
weakMap.set(john, "—Å–µ–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏");
// —è–∫—â–æ –æ–±‚Äô—î–∫—Ç john –∑–Ω–∏–∫–Ω–µ, —Å–µ–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –±—É–¥—É—Ç—å –∑–Ω–∏—â–µ–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
```

–ü–æ–¥–∏–≤—ñ–º–æ—Å—è –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥.

–£ –Ω–∞—Å —î –∫–æ–¥, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –º–∞–ø—ñ: –æ–±‚Äô—î–∫—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —î –∫–ª—é—á–µ–º, –∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å -- —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è. –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–Ω–∏–∫–∞—î (–π–æ–≥–æ –æ–±‚Äô—î–∫—Ç –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è), –º–∏ –±—ñ–ª—å—à–µ –Ω–µ —Ö–æ—á–µ–º–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –π–æ–≥–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å.

–û—Å—å –ø—Ä–∏–∫–ª–∞–¥ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É –∑ `Map`:

```js
// üìÅ visitsCount.js
let visitsCountMap = new Map(); // –º–∞–ø–∞: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á => –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å

// –∑–±—ñ–ª—å—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å
function countUser(user) {
  let count = visitsCountMap.get(user) || 0;
  visitsCountMap.set(user, count + 1);
}
```

–Ü –æ—Å—å —â–µ –æ–¥–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ –∫–æ–¥—É, –º–æ–∂–ª–∏–≤–æ, —ñ–Ω—à–∏–π —Ñ–∞–π–ª –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü–µ:

```js
// üìÅ main.js
let john = { name: "–Ü–≤–∞–Ω" };

countUser(john); // —Ä–∞—Ö—É—î –π–æ–≥–æ –≤—ñ–∑–∏—Ç–∏

// –ø—ñ–∑–Ω—ñ—à–µ john –ø–æ–∫–∏–¥–∞—î –Ω–∞—Å
john = null;
```

–ó–∞—Ä–∞–∑, –æ–±‚Äô—î–∫—Ç `john` –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è–º, –∞–ª–µ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ –ø–∞–º‚Äô—è—Ç—ñ —Ç–æ–º—É, —â–æ —Ü–µ –∫–ª—é—á `visitsCountMap`.

–ù–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—á–∏—â—É–≤–∞—Ç–∏ `visitsCountMap`, –∫–æ–ª–∏ –º–∏ –≤–∏–¥–∞–ª—è—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —ñ–Ω–∞–∫—à–µ –≤—ñ–Ω –±—É–¥–µ —Ä–æ—Å—Ç–∏ –≤ –ø–∞–º‚Äô—è—Ç—ñ –Ω–µ–æ–±–º–µ–∂–µ–Ω–æ –¥–æ–≤–≥–æ. –¢–∞–∫–µ –æ—á–∏—â–µ–Ω–Ω—è –º–æ–∂–µ —Å—Ç–∞—Ç–∏ –Ω—É–¥–Ω–∏–º –∑–∞–≤–¥–∞–Ω–Ω—è–º —É —Å–∫–ª–∞–¥–Ω–∏—Ö –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞—Ö.

–ú–∏ –º–æ–∂–µ–º–æ —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü—å–æ–≥–æ, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ –Ω–∞ `WeakMap`:

```js
// üìÅ visitsCount.js
let visitsCountMap = new WeakMap(); // weakmap: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á => –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å

// –∑–±—ñ–ª—å—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å
function countUser(user) {
  let count = visitsCountMap.get(user) || 0;
  visitsCountMap.set(user, count + 1);
}
```

–¢–µ–ø–µ—Ä –º–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –æ—á–∏—â–∞—Ç–∏ `visitsCountMap`. –ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –æ–±‚Äô—î–∫—Ç `john` —Å—Ç–∞—î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–º –±—É–¥—å-—è–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º, –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º —Ç–æ–≥–æ, —è–∫ –∫–ª—é—á `WeakMap`, –≤—ñ–Ω –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–∞–º‚Äô—è—Ç—ñ, —Ä–∞–∑–æ–º –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –∑–∞ —Ü–∏–º –∫–ª—é—á–µ–º –≤ `WeakMap`.

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: –∫–µ—à—É–≤–∞–Ω–Ω—è

–Ü–Ω—à–∏–º –∑–∞–≥–∞–ª—å–Ω–∏–º –ø—Ä–∏–∫–ª–∞–¥–æ–º —î –∫–µ—à—É–≤–∞–Ω–Ω—è. –ú–∏ –º–æ–∂–µ–º–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ ("–∫–µ—à") —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ–± –º–∞–π–±—É—Ç–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –Ω–∞ —Ç–æ–º—É –∂ –æ–±‚Äô—î–∫—Ç—ñ –º–æ–≥–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ.

–©–æ–± –¥–æ—Å—è–≥—Ç–∏ —Ü—å–æ–≥–æ, –º–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `Map` (–Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π):

```js run
// üìÅ cache.js
let cache = new Map();

// –æ–±—á–∏—Å–ª–∏—Ç–∏ —Ç–∞ –∑–∞–ø–∞–º‚Äô—è—Ç–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –¥–ª—è */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

*!*
// –¢–µ–ø–µ—Ä –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ process() –≤ —ñ–Ω—à–æ–º—É —Ñ–∞–π–ª—ñ:
*/!*

// üìÅ main.js
let obj = {/* —Å–∫–∞–∂—ñ–º–æ, —É –Ω–∞—Å —î –æ–±‚Äô—î–∫—Ç */};

let result1 = process(obj); // —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ

// ...–ø—ñ–∑–Ω—ñ—à–µ, –∑ —ñ–Ω—à–æ–≥–æ –º—ñ—Å—Ü—è –≤ –∫–æ–¥—ñ...
let result2 = process(obj); // –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –≤–∑—è—Ç–∏–π –∑ –∫–µ—à—É

// ...–ø—ñ–∑–Ω—ñ—à–µ, –∫–æ–ª–∏ –æ–±‚Äô—î–∫—Ç –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π:
obj = null;

alert(cache.size); // 1 (–û–π! –û–±‚Äô—î–∫—Ç –¥–æ—Å—ñ –≤ –∫–µ—à—ñ —ñ –∑–∞–π–º–∞—î –ø–∞–º‚Äô—è—Ç—å!)
```

–î–ª—è –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ `process(obj)` –∑ —Ç–∏–º —Å–∞–º–∏–º –æ–±‚Äô—î–∫—Ç–æ–º –≤—ñ–Ω –ª–∏—à–µ –æ–±—á–∏—Å–ª—é—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–ø–µ—Ä—à–µ, –∞ –ø–æ—Ç—ñ–º –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ –π–æ–≥–æ –∑ `cache`. –ù–µ–¥–æ–ª—ñ–∫–æ–º —î —Ç–µ, —â–æ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —á–∏—Å—Ç–∏—Ç–∏ `cache`, –∫–æ–ª–∏ –æ–±‚Äô—î–∫—Ç –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π.

–Ø–∫—â–æ –º–∏ –∑–∞–º—ñ–Ω–∏–º–æ `Map` –Ω–∞ `WeakMap`, —Ç–æ —Ü—è –ø—Ä–æ–±–ª–µ–º–∞ –∑–Ω–∏–∫–∞—î. –ö–µ—à–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –ø–∞–º‚Äô—è—Ç—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –æ–±‚Äô—î–∫—Ç –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è.

```js run
// üìÅ cache.js
*!*
let cache = new WeakMap();
*/!*

// –æ–±—á–∏—Å–ª–∏—Ç–∏ —Ç–∞ –∑–∞–ø–∞–º‚Äô—è—Ç–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

// üìÅ main.js
let obj = {/* —è–∫–∏–π—Å—å –æ–±‚Äô—î–∫—Ç */};

let result1 = process(obj);
let result2 = process(obj);

// ...–ø—ñ–∑–Ω—ñ—à–µ, –∫–æ–ª–∏ –æ–±‚Äô—î–∫—Ç –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π:
obj = null;

// –ù–µ –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ cache.size —Ç–æ–º—É, —â–æ —Ü–µ WeakMap,
// –∞–ª–µ —Ü–µ 0 –∞–±–æ –Ω–µ–∑–∞–±–∞—Ä–æ–º –±—É–¥–µ 0
// –ö–æ–ª–∏ obj –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è, –∫–µ—à–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –±—É–¥—É—Ç—å –≤–∏–ª—É—á–µ–Ω—ñ —Ç–∞–∫–æ–∂
```

## WeakSet

`WeakSet` –ø–æ–≤–æ–¥–∏—Ç–∏—Å—è –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ:

- –¶–µ –∞–Ω–∞–ª–æ–≥ `Set`, –∞–ª–µ –º–∏ –º–æ–∂–µ–º–æ –¥–æ–¥–∞—Ç–∏ –ª–∏—à–µ –æ–±‚Äô—î–∫—Ç–∏ –¥–æ `WeakSet` (–Ω–µ –ø—Ä–∏–º—ñ—Ç–∏–≤–∏).
- –û–±‚Äô—î–∫—Ç —ñ—Å–Ω—É—î –≤ –Ω–∞–±–æ—Ä—ñ, –∫–æ–ª–∏ –≤—ñ–Ω –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ –¥–µ-–Ω–µ–±—É–¥—å —â–µ.
- –¢–∞–∫ —Å–∞–º–æ —è–∫ `Set`, –≤—ñ–Ω –ø—ñ–¥—Ç—Ä–∏–º—É—î `add`, `has` —ñ `delete`, –∞–ª–µ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î `size`, `keys()` —Ç–∞ —ñ—Ç–µ—Ä–∞—Ü—ñ—é.

–ë—É–¥—É—á–∏ "—Å–ª–∞–±–∫–∏–º", –≤—ñ–Ω —Ç–∞–∫–æ–∂ —Å–ª—É–∂–∏—Ç—å –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö. –ê–ª–µ –Ω–µ –¥–ª—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –∞ –¥–ª—è —Ñ–∞–∫—Ç—ñ–≤ "—Ç–∞–∫/–Ω—ñ". –ü—Ä–∏–Ω–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –¥–æ `WeakSet` –º–æ–∂–µ –æ–∑–Ω–∞—á–∞—Ç–∏ —â–æ—Å—å –ø—Ä–æ –æ–±‚Äô—î–∫—Ç.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –º–∏ –º–æ–∂–µ–º–æ –¥–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ `WeakSet`, —â–æ–± –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ç–∏—Ö, —Ö—Ç–æ –≤—ñ–¥–≤—ñ–¥–∞–≤ –Ω–∞—à —Å–∞–π—Ç:

```js run
let visitedSet = new WeakSet();

let john = { name: "–Ü–≤–∞–Ω" };
let pete = { name: "–ü–µ—Ç—Ä–æ" };
let mary = { name: "–ú–∞—Ä—ñ—è" };

visitedSet.add(john); // –Ü–≤–∞–Ω –≤—ñ–¥–≤—ñ–¥–∞–≤ –Ω–∞—Å
visitedSet.add(pete); // –ü–æ—Ç—ñ–º –ü–µ—Ç—Ä–æ
visitedSet.add(john); // –ó–Ω–æ–≤—É –Ü–≤–∞–Ω

// visitedSet –º–∞—î –∑–∞—Ä–∞–∑ 2-–æ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

// –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤—ñ–¥–≤—ñ–¥–∞–≤ –Ü–≤–∞–Ω?
alert(visitedSet.has(john)); // true

// –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤—ñ–¥–≤—ñ–¥–∞–ª–∞ –ú–∞—Ä—ñ—è?
alert(visitedSet.has(mary)); // false

john = null;

// visitedSet –±—É–¥–µ –æ—á–∏—â–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
```

–ù–∞–π–±—ñ–ª—å—à –ø–æ–º—ñ—Ç–Ω–∏–º –æ–±–º–µ–∂–µ–Ω–Ω—è–º `WeakMap` —Ç–∞ `WeakSet` —î –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —ñ—Ç–µ—Ä–∞—Ü—ñ–π —Ç–∞ –Ω–µ–∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–µ—Å—å –ø–æ—Ç–æ—á–Ω–∏–π –≤–º—ñ—Å—Ç. –¶–µ –º–æ–∂–µ –≤–∏—è–≤–∏—Ç–∏—Å—è –Ω–µ–∑—Ä—É—á–Ω–∏–º, –∞–ª–µ –Ω–µ –ø–µ—Ä–µ—à–∫–æ–¥–∂–∞—î `WeakMap/WeakSet` –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Å–≤–æ—é –æ—Å–Ω–æ–≤–Ω—É —Ä–æ–±–æ—Ç—É -- –±—É—Ç–∏ ¬´–¥–æ–¥–∞—Ç–∫–æ–≤–∏–º¬ª —Å—Ö–æ–≤–∏—â–µ–º –¥–∞–Ω–∏—Ö –¥–ª—è –æ–±‚Äô—î–∫—Ç—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è/—É–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –≤ —ñ–Ω—à–æ–º—É –º—ñ—Å—Ü—ñ.

## –ü—ñ–¥—Å—É–º–∫–∏

`WeakMap` -- —Ü–µ –ø–æ–¥—ñ–±–Ω–∞ –¥–æ `Map` –∫–æ–ª–µ–∫—Ü—ñ—è, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–∏—à–µ –æ–±‚Äô—î–∫—Ç–∏, —è–∫ –∫–ª—é—á—ñ —ñ –≤–∏–¥–∞–ª—è—î —ó—Ö —Ä–∞–∑–æ–º –∑ –ø–æ–≤‚Äô—è–∑–∞–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º, –∫–æ–ª–∏ –≤–æ–Ω–∏ —Å—Ç–∞–Ω—É—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ —ñ–Ω—à–∏–º –∑–∞—Å–æ–±–∞–º.

`WeakSet` -- —Ü–µ –ø–æ–¥—ñ–±–Ω–∞ –¥–æ `Set` –∫–æ–ª–µ–∫—Ü—ñ—è, —è–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î —Ç—ñ–ª—å–∫–∏ –æ–±‚Äô—î–∫—Ç–∏ —Ç–∞ –≤–∏–¥–∞–ª—è—î —ó—Ö –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤–æ–Ω–∏ —Å—Ç–∞–Ω—É—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ —ñ–Ω—à–∏–º –∑–∞—Å–æ–±–∞–º.

–á—Ö –æ—Å–Ω–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤–∞–≥–∞ –ø–æ–ª—è–≥–∞—î —É —Ç–æ–º—É, —â–æ –≤–æ–Ω–∏ –º–∞—é—Ç—å —Å–ª–∞–±–∫–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±‚Äô—î–∫—Ç–∏, —Ç–æ–º—É –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ª–µ–≥–∫–æ –≤–∏–¥–∞–ª–µ–Ω–∏–º–∏ –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è.

–¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ `clear`, `size`, `keys`, `values`...

`WeakMap` —Ç–∞ `WeakSet` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —è–∫ "–≤—Ç–æ—Ä–∏–Ω–Ω—ñ" —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö, –Ω–∞ –¥–æ–¥–∞—Ç–æ–∫ –¥–æ "–ø–µ—Ä–≤–∏–Ω–Ω–æ–≥–æ" —Å—Ö–æ–≤–∏—â–∞ –æ–±‚Äô—î–∫—Ç—ñ–≤. –ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –æ–±‚Äô—î–∫—Ç –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–µ—Ä–≤–∏–Ω–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞, —è–∫—â–æ –≤—ñ–Ω –≤–∏—è–≤–ª—è—î—Ç—å—Å—è –ª–∏—à–µ —è–∫ –∫–ª—é—á `WeakMap` –∞–±–æ –≤ `WeakSet`, –≤—ñ–Ω –±—É–¥–µ –æ—á–∏—â–µ–Ω–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.
