# Оператор об’єднання з null '??'

[recent browser="new"]

Оператор об’єднання з null `??` забезпечує короткий синтаксис для вибору першої визначеної змінної зі списку.

Результатом виразу `a ?? b` є:
- `a`, якщо ця змінна не дорівнює `null` чи`undefined`,
- `b` в іншому випадку.

Тобто `x = a ?? b` є скороченим варіантом для:

```js
x = (a !== null && a !== undefined) ? a : b;
```

Розглянемо довший приклад.

Скажімо, змінні `firstName`, `lastName` та `nickName` відповідають імені, прізвищу так ніку користувача. Усі три можуть бути невизначеними, якщо користувач вирішить не вводити жодних даних.

Ми б хотіли відобразити ім’я користувача в будь-якому випадку — вжити одну із змінних або рядок "Анонім", якщо всі змінні "пусті".

Оператор `??` допоможе вибрати перше установлене значення:

```js run
let firstName = null;
let lastName = null;
let nickName = "Суперкодер";

// покажемо перше значення, що не є null чи undefined
*!*
alert(firstName ?? lastName ?? nickName ?? "Анонім"); // Суперкодер
*/!*
```

## Відмінності від оператора ||

Оператор АБО `||` можна використовувати таким же чином, як і оператор `??`. В останньому прикладі можна замінити `??` на `||`, і результат залишиться незмінним. Ми вже бачили такий приклад в [минулому розділі](info:logical-operators#or-finds-the-first-truthy-value).

Але є істотні відмінності:
- `||` повертає перше *правдиве* значення.
- `??` повертає перше *установлене* значення.

Це дуже важливо, якщо ми хочемо відрізнити `null/undefined` від числа `0` чи пустого рядка `''`.

Уявіть такий приклад:

```js
height = height ?? 100;
```

Тут ми присвоюємо змінній `height` число `100`, якщо вона не визначена.

Порівняймо з оператором `||`:

```js run
let height = 0;

alert(height || 100); // 100
alert(height ?? 100); // 0
```

Тут вираз `height || 100` не відрізняє нульову висоту від невизначеної, тобто від значень `null`, `undefined` або будь-якого іншого хибного значення. Тому в результаті обчислення ми отримуємо `100`.

Вираз `height ?? 100` повертає `100`, тільки якщо `height` дорівнює саме значенням `null` чи `undefined`. Отже `alert` показує значення нульової висоти як `0`, без помилкової зміни.

Якій поведінці надати перевагу, залежить від ситуації. Якщо нульова висота прийнятна, слід вибрати оператор `??`.

## Пріоритет

Пріоритет оператора `??` порівняно низький: `5` в [таблиці MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#Table).

Тому `??` обчислюється після більшості інших операцій, але перед операторами `=` та `?`.

Якщо треба вибрати значення в складному виразі, оператору `??` можна "допомогти" дужками:

```js run
let height = null;
let width = null;

// важливо: скористайтесь дужками
let area = (height ?? 100) * (width ?? 50);

alert(area); // 5000
```

Якщо ми не додамо дужки, оператор `*` буде обчислений раніше `??`, тому що його пріоритет вище.

Тобто вираз буде працювати як такий:

```js
// це, напевно, помилка
let area = height ?? (100 * width) ?? 50;
```

Варто також згадати про одне обмеження на рівні мови.

**З міркувань безпеки, заборонено використовувати `??` разом з операторами `&&` та `||`.**

Наступний код призведе до помилки:

```js run
let x = 1 && 2 ?? 3; // Синтаксична помилка
```

Обмеження, певна річ, спірне, але його внесли до специфікації мови, щоб запобігти помилкам програмістів, оскільки розробники почали замінювати `??` на `||`.

Щоб подолати це обмеження, скористайтесь явними дужками:

```js run
*!*
let x = (1 && 2) ?? 3; // Працює
*/!*

alert(x); // 2
```

## Підсумки

- Оператор об’єднання з null `??` забезпечує короткий спосіб вибрати значення, відмінне від `null` та `undefined`.

    З його допомогою присвоюють початкові значення:

    ```js
    // установити height=100, якщо height дорівнює null чи undefined
    height = height ?? 100;
    ```

- Оператор `??` має дуже низький пріоритет, трохи вище за оператори `?` та `=`.
- Використання цього оператора разом з `||` чи `&&` без явних дужок забороняється.
